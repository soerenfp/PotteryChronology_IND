---
title: "Timeline_DescriptiveStatistics"
author: "Soren Pedersen"
date: "2024-11-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. 

--------------------------------------------------------------------------------

### IDEAS FOR THIS DOCUMENT ###

To better understand my data I have made a document to explore the data:

- which rim type is most popular overall? -DONE-
- which rim type is most popular per site?
- which rim type is most popular through time?

- which base type is most popular overall? -DONE-
- which base type is most popular per site?
- which base type is most popular through time?

- Which vessel type is most dominant overall? -DONE-
- Which vessel type is most dominant per site?
- Which vessel type is most dominant through time?

- What size category is dominant overall? -DONE-
- What size category is dominant per site?
- What size category is dominant through time?

-----------------------------------------
### STEP 0: Install and load packages ###
-----------------------------------------

```{r, echo=TRUE}

# Install necessary packages:

# install.packages("readxl")    # For reading Excel files
# install.packages("dplyr")
# install.packages("ggplot2")
# install.packages("factoextra") # For visualizing clusters
# install.packages("cluster")
# install.packages("ggplot2")
# install.packages("cowplot")
# install.packages("tidyr")
# install.packages("stringr")
# install.packages("openxlsx")
# install.packages("vcd")
# install.packages("reshape2")
# install.packages("devtools")
# install.packages("rrtools")
# install.packages("remotes")

# Load necessary libraries:

library(devtools)
#library(rrtools)
library(remotes)
library(readxl)
library(dplyr)
library(ggplot2)
library(factoextra)
library(cluster)
library(cowplot)
library(tidyr)
library(stringr)
library(openxlsx)
library(vcd)
library(reshape2)

```

--------------------------------------------------------------------------------
# STEP 0: Load data (Skip if you have already loaded the data in previous steps)
--------------------------------------------------------------------------------

# Load data

```{r, echo=TRUE}

# Load your dataset from an Excel file
ceramics_data <- read_excel("analysis/data/raw_data/data_measurements_01.xlsx")

# Ensure your Excel file has columns: actual_diameter, actual_width, actual_height
# Check the first few rows of your data
head(ceramics_data)

```

-----------------------------------------------------
# STEP 1: Make a dataset for the descriptive analysis
-----------------------------------------------------

- I made a new data set only including the "site_name", "type_category", "size_category", ""rim_category", "base_category", "attributes", "actual_diameter", "actual_height", "actual_width"
- (NOT: I removed rows with missing values in the "actual_diameter" column (registered as 0.0 in the excel sheet))
- This dataset it used for making the following "nice" boxplots!

```{r, echo=TRUE}
ceramics_subset <- ceramics_data %>%
#  filter(actual_diameter != 0.0) %>%   #Only filter the 0,0s later!
  select(site_name, type_category, size_category, rim_category, base_category, 
         attributes, actual_diameter, actual_height, actual_width)

```

So, now I created a data set "ceramics_subset" of the columns noted above (NOT: and removed rows from the "actual_diameter" column that contained 0.0 values). Tha dataset still contains the original 611 vessels.

-------------------------------------------------------------
# Step 2: Boxplot of data points per 'type_category' category
-------------------------------------------------------------

```{r, echo=TRUE}
# Used libraries:
#library(ggplot2)
#library(cowplot)

# Load required libraries
#library(ggplot2)
#library(cowplot)

# Create a data frame to count the number of data points for each vessel type
vessel_counts <- data.frame(table(ceramics_subset$type_category))   #make a data set of type_category and the counts per category

colnames(vessel_counts) <- c("type_category", "count")    #name the columns in vessel_counts

# Create the bar plot of 'Data points per vessel type'
bar_plot <- ggplot(vessel_counts, aes(x = as.factor(type_category), y = count)) +
  geom_col(fill = "lightblue") +
  labs(title = "Number of Data Points per Vessel Type",
       x = "Vessel Type",
       y = "Number of Data Points") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for better visibility
    plot.margin = margin(10, 10, 10, 10)  # Adjust plot margins if needed
  )

# Legend table for vessel type descriptions
legend_table <- data.frame(
  type_category = 1:15,
  Description = c("Wide-open vessels", "Open vessels", "Closed horizontal-oval vessels", 
                  "Vertical vessels", "Closed vessels", "Tightly-closed vessels", 
                  "Open carinated vessels", "Wide-open carinated vessels", 
                  "Vertical-vertical oval vessels", "Closed-vertical oval vessels", 
                  "Tightly-closed vertical oval vessels", "Lids", 
                  "Flasks", "Bottles", "Tellem tripods")
)

# Convert the legend table to a plot with adjusted margins
legend_plot <- ggplot(legend_table, aes(x = "", y = type_category, label = paste(type_category, "=", Description))) +
  geom_text(hjust = 0, size = 3) +  # Reduced text size
  theme_void() +
  theme(
    plot.margin = margin(5, 20, 5, -140)  # Adjusted margins for readability
  )

# Arrange the bar plot and the legend side by side with adjusted widths
cowplot::plot_grid(bar_plot, legend_plot, ncol = 2, rel_widths = c(3, 1.5))  # Reduced legend width

```
This plot looks nice! It includes all the 611 vessels.

NIck (DONE): You need a barplot here, change geom_boxplot() to geom_bar()

# PRELIM interpretation:

- Vessel category 5 (closed vessels) has by far the most data points -> interesting because it also has the most multi purpose function!!!
- 2nd most data point are vessel category 4 (vertical vessels) -> also interesting because I think this is also a very multi purpose vessel!!!
- 3rd most data point are vessel category 2 (open vessels)
- 4th most data point are vessel category 7 (Open carinated vessels)
- 5th most data point are vessel category 1 (wide-open vessels)
- 6th most data point are vessel category 15 (Tellem tripods)
- 7th and 8th most data point are vessel category 3 (closed horizontal-oval vessels) and 10 (closed vertical-oval vessels)
- 9th most data point are vessel category 6 (tightly-closed vessels)
- 10th most data point are vessel category 8 (wide-open carinated vessels)
- 11th most data point are vessel category 9 (Vertical vertical-oval vessels)
- 12th most data point are vessel category 11 (tightly-closed vertical oval vessels)
- 13th most data point are vessel category 14 (bottles)
- 14th most data point are vessel category 13 (flasks)
- vessel category 12 is left out because there are no data points (lids)

- There is actually a correlation between how "multi-purpose" a vessel is and the amount of data points I have collected. The "closed vessels", "vertical vessels" and the "open vessels" are the three categories you can describe as the most multi-purpose!

-NICK/me: this also points to the conservationism of the pottery, in where the oldest forms are also the most numerous. They do not change the pottery types so often!

---------------------------------------------------------------
# STEP 3: Boxplot of how many datapoint I have per rim category
---------------------------------------------------------------

```{r, echo=TRUE}
# Used libraries
#library(ggplot2)

# Boxplot of 'Counts per Rim Category' 

#ggplot(ceramics_data_typesplit, aes(x = rim_category)) +
  #geom_bar() +
  #labs(x = "Rim Category", y = "Count", title = "Counts per Rim Category") +
  #theme_minimal()

#NIck: drop the NAs before plotting

ceramics_data %>% 
drop_na(rim_category) %>% 
ggplot(aes(x = rim_category)) +
  geom_bar() +
  labs(x = "Rim Category", y = "Count", title = "Counts per Rim Category") +
  theme_minimal()
```

Let's try to make the plot nicer

```{r, echo=TRUE}

# Load required libraries
#library(ggplot2)
#library(cowplot)

# Create a data frame to count the number of data points for each vessel type
rim_counts <- data.frame(table(ceramics_data$rim_category))
colnames(rim_counts) <- c("rim_category", "Count")

# Create the bar plot of 'Data points per vessel type'
bar_plot <- ggplot(rim_counts, aes(x = as.factor(rim_category), y = Count)) +
  geom_col(fill = "lightblue") +
  labs(title = "Number of Data Points per Rim Type",
       x = "Rim Type",
       y = "Number of Data Points") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for better visibility
    plot.margin = margin(10, 10, 10, 10)  # Adjust plot margins if needed
  )

# Legend table for vessel type descriptions
legend_table <- data.frame(
  Rim_Type = 1:27,
  Abbreviation = c("Sr", "Sp", "Sf", "Sb", "Es", "Ec", "Ecc", "Ef", "Efl", "Ep", 
                   "Et", "Esg", "Emg", "Vs", "Vc", "Oth", "Otc", "Otf", "Ith", 
                   "Itc", "Itf", "Th", "Tc", "Tf", "Ca", "I", "Y"),
  Description = c("Simple, rounded", "Simple, pointy", "Simple, flattened", 
                  "Simple, bevelled", "Everted, simple", "Everted, collared", 
                  "Everted, collared channelled", "Everted, flaring", 
                  "Everted, flattened", "Everted, protruding", 
                  "Everted, thickened", "Everted, single groove", 
                  "Everted, multiple groove", "Vertical, simple", "Vertical, collared", 
                  "Outward thickened, hinged", "Outward thickened, curved", 
                  "Outward thickened, flattened", "Inwards thickened, hinged",
                  "Inwards thickened, curved", "Inwards thickened, flattened",
                  "Thickened, hinged", "Thickened, curved", "Thickened, flattened",
                  "Carinated", "Inverted", "Y-rims")
)

# Convert the legend table to a plot with adjusted margins and abbreviations
legend_plot <- ggplot(legend_table, aes(x = "", y = Rim_Type, label = paste(Abbreviation, "=", Description))) +
  geom_text(hjust = 0, size = 3) +  # Reduced text size
  theme_void() +
  theme(
    plot.margin = margin(5, 20, 5, -140)  # Adjusted margins for readability
  )

# Arrange the bar plot and the legend side by side with adjusted widths
cowplot::plot_grid(bar_plot, legend_plot, ncol = 2, rel_widths = c(3, 1.5))  # Reduced legend width

```
So, this looks damn good! 

# PRELIM interpretation of trial data:

- The Sr (Simple Rounded) category is by far the most represented, as expected! Perhaps you can also say that this category is very multi-purpose because it does not include or exclude any functions?

- The Es (Everted Simple) category is the 2nd highest represented. This is also one of the earliest categories of rims (after the Sr, and 'thickened' categories). This rim category is for handling the vessel, to fasten a cloth and string around to close the vessel, or to pour from.

- The Otc (Outwards Thickened, curved) is the 3rd highest category and also the 2nd earliest rim type - if I remember correctly! This type is for handling the vessel (not hot vessel!), close the vessel with string and cloth, or to reinforce the rim.

- The Itc (Inwards Thickened, curved) is the 4th highest category. This category is also for handling the vessel or to reinforce the rim.

- The Sf (Simple, flattened) rim are the 5th highest category, and there is perhaps not so much function in this rim. Perhaps you can easier stack the vessels, but I think it is mosly for appearence. 

- The Oth (Outwards thickened, hinged) rims are the 6th highest category, and here the rim is for grabbing or reinforcing the vessel, but because it has a sharp corner under the rim then perhaps it is better suited for closing the vessel with cloth and string. This can also be an over-interpretation and the sharp corner under the rim can be just for aesthetics, or for a better grip?.

- The 7th and 8th highest categories are the Sb (Simple, beveled) and Sp (Simple, pointy) categories. I think these categories are mostly for aesthetics, but there can be some stacking functions in these

- the 9th highest category is the Tc (Thickened, curved) category, where this is for grapping or reinforcing the vessel. 

- The rest of the categories are quite evenly represented!

----------------------------------------------------------------
# STEP 4: Boxplot of how many datapoint I have per base category
----------------------------------------------------------------

```{r, echo=TRUE}

# Used libraries
#library(ggplot2)
#library(tidyr)

# Boxplot of 'Counts per Base Category' 
ceramics_subset %>% 
  drop_na(base_category) %>%  #Drop NAs in 'base_category'
ggplot(aes(x = base_category)) +
  geom_bar() +
  labs(x = "Base Category", y = "Count", title = "Counts per Base Category") +
  theme_minimal()

```
So, this looks nice !

Let's try to make the plot nicer

```{r, echo=TRUE}

# Load required libraries
#library(ggplot2)
#library(cowplot)

# Create a data frame to count the number of data points for each vessel type
base_counts <- data.frame(table(ceramics_subset$base_category))
colnames(base_counts) <- c("base_category", "Count")

# Create the bar plot of 'Data points per vessel type'
bar_plot <- ggplot(base_counts, aes(x = as.factor(base_category), y = Count)) +
  geom_col(fill = "lightblue") +
  labs(title = "Number of Data Points per Base Type",
       x = "Base Type",
       y = "Number of Data Points") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for better visibility
    plot.margin = margin(10, 10, 10, 10)  # Adjust plot margins if needed
  )

# Legend table for vessel type descriptions
legend_table <- data.frame(
  Base_Type = 1:9,
  Abbreviation = c("Bf", "Br", "Bpe", "Bl", "Bc", "Bpo", "Sp", "Bro", "Bt"),
  Description = c("Bases, flat", "Bases, ring", "Bases, pedestal", 
                  "Bases, legged", "Bases, concave", "Bases, pointy", "Special", 
                  "Bases, rounded", "Bases, tripod")
)

# Convert the legend table to a plot with adjusted margins and abbreviations
legend_plot <- ggplot(legend_table, aes(x = "", y = Base_Type, label = paste(Abbreviation, "=", Description))) +
  geom_text(hjust = 0, size = 3) +  # Reduced text size
  theme_void() +
  theme(
    plot.margin = margin(5, 20, 5, -140)  # Adjusted margins for readability
  )

# Arrange the bar plot and the legend side by side with adjusted widths
cowplot::plot_grid(bar_plot, legend_plot, ncol = 2, rel_widths = c(3, 1.5))  # Reduced legend width

```
So, this plot looks nice! It only includes the vessels that have a registered base, so NA's are excluded!

OBS: I need to include the registrations I have from the excavation reports I have in the RAW database in the final presentation!

#PRELIM interpretation of trial data:

- Most of the bases are NA because nothing was registered
- Bpe (Base, pedestalled) are the category with most data points -> in this category we also have the Tellem tripods base - perhaps I need to make a separate category for that!
- Br (Bases, ring) are the 2nd highest category
- Bf (Bases flat) are the 3rd highest category
- Bpo (Bases, pointy) are the 4th highest category
- Bl (Bases, legged) I think only has one count (jenne-jeno)
- Special -> I must find out what is the special category!

----------------------------------------------------------------
# STEP 5: Boxplot of how many datapoint I have per size cateogry
----------------------------------------------------------------

```{r, echo=TRUE}
ceramics_data %>% 
drop_na(size_category) %>% 
ggplot(aes(x = size_category)) +
  geom_bar() +
  labs(x = "Size Category", y = "Count", title = "Counts per Size Category") +
  theme_minimal()
```
Very nice! As expected I have the most vessels in size category "b", but surprising is that the small size category "a" is so dominant.

Let's try to make the plot a little nicer

```{r, echo=TRUE}

# Load required libraries
#library(ggplot2)
#library(cowplot)

# Create a data frame to count the number of data points for each vessel type
size_counts <- data.frame(table(ceramics_subset$size_category))
colnames(size_counts) <- c("size_category", "Count")

# Create the bar plot of 'Data points per vessel type'
bar_plot <- ggplot(size_counts, aes(x = as.factor(size_category), y = Count)) +
  geom_col(fill = "lightblue") +
  labs(title = "Number of Data Points per Size category",
       x = "Size Category",
       y = "Number of Data Points") +
  theme_minimal() +
  theme(
    axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for better visibility
    plot.margin = margin(10, 10, 10, 10)  # Adjust plot margins if needed
  )

# Legend table for vessel type descriptions
legend_table <- data.frame(
  Size_Type = 1:5,
  Abbreviation = c("a", "b", "c", "d", "e"),
  Description = c("<14 cm", "15-24 cm", "25-34 cm", "35-44 cm", ">45 cm")
)

# Convert the legend table to a plot with adjusted margins and abbreviations
legend_plot <- ggplot(legend_table, aes(x = "", y = Size_Type, label = paste(Abbreviation, "=", Description))) +
  geom_text(hjust = 0, size = 3) +  # Reduced text size
  theme_void() +
  theme(
    plot.margin = margin(5, 20, 5, -140)  # Adjusted margins for readability
  )

# Arrange the bar plot and the legend side by side with adjusted widths
cowplot::plot_grid(bar_plot, legend_plot, ncol = 2, rel_widths = c(3, 1.5))  # Reduced legend width

```
So, this looks very nice!

# Interpretation of the 02_timelinedata results

OBS: Remember that the size categories are based on the "actual_width" of the vessels and NOT something like volume

- Surprising that the "a" size category is so dominant. This is perhaps because the small vessels are often dropped or broken?? 14.9 cm (the largest vessels in this category) might be used for cooking also, but by far the most vessels are small short-term storage pots, or perhaps special vessels for casting or salt making??

- As expected, the size category "b" is the most dominant vessel size. In this category you would expect to find the "normal" cooking vessels and vessels that are more or less multi-purpose.

- As expected, the size category "c" is dominant, but only third most dominant after the size "a" groups (slightly). In this category I would expect that many of the "wide-open vessels" are represented, and otherwise many sort- to medium-term storage vessels.

- As expected, the size "d" vessels are not so dominant. In this category I would expect to find the long-term storage vessels, fermenting/brewing vessels, and many of the large "wide-open" vessels.

- As expected, the size cateogry "e" is the least dominant. I this category I would expect to find the very large "wide-open" vessels, and otherwise vessels that are highly specialized like large brewing vessels or special long-term storage vessels (perhaps to be dug into the ground?).

---------------------------------------------------------
# STEP ??: Exploring the development of size through time
---------------------------------------------------------

#Q in Chad: 
"I have plotted my vessel in BC and AD terms (example: 250-100 BC, 150-300 AD) and I need to see the development of vessel sizes through time. How do I do this? Shall I change my BC terms in my spreadsheet to -250-100, or how?"

#A from Chad
To analyze the development of vessel sizes through time, it's essential to convert your BC and AD dates into a continuous numerical scale. This ensures that you can plot the data effectively and interpret trends over time. Here's how to handle it:

- 1. Convert BC and AD into a Continuous Scale

BC Dates: Represent BC dates as negative numbers. For example:
250–100 BC → -250 to -100

AD Dates: Represent AD dates as positive numbers. For example:
150–300 AD → 150 to 300

- 2. Adjust Your Spreadsheet

Create two columns in your spreadsheet for the start date and end date of each time range:
For 250–100 BC, enter -250 in the start column and -100 in the end column.
For 150–300 AD, enter 150 in the start column and 300 in the end column.

- 3. Calculate the Midpoint of Each Time Range

Add a new column for the midpoint (average) of the time range:

midpoint = ("start date" + "end date") / 2

For example:
For BC: -250 to -100: Midpoint = (−250+ −100)/2= -175
For AD: 150 to 300: Midpoint = (150+300)/2= 225

This will provide a single value for each vessel's time period, making it easier to analyze trends.

- 4. Visualize Vessel Sizes Through Time

Use the midpoint column as the x-axis (time) and vessel size (e.g., height, diameter, or volume) as the y-axis.

Create a scatter plot, line plot, or boxplot using ggplot2 in R or your preferred plotting tool:

```{r, echo=TRUE}
ggplot(data, aes(x = midpoint, y = vessel_size)) +
  geom_point() + 
  geom_smooth(method = "loess", se = FALSE) +  # Optional trend line
  labs(title = "Development of Vessel Sizes Over Time",
       x = "Time (Years, BC/AD)",
       y = "Vessel Size") +
  theme_minimal()
```

- 5. Consider Trends

Look for patterns, such as increases or decreases in size over time or abrupt changes during specific periods.

Use color or shapes to differentiate vessel types, rim categories, or other attributes to add depth to the analysis.

